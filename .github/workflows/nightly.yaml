name: Nightly
on:
  # schedule:
  #   - cron: '0 0 * * *' # Every day at midnight
  # pull_request:
  #   paths:
  #     - '.github/workflows/nightly.yaml'
  push:
    branches: [  ]

jobs:
  linux:
    name: Linux
    runs-on: ubuntu-latest

    steps:
      - uses: actions/setup-go@v2
        with:
          go-version: '1.16'

      - uses: actions/checkout@v2

      - name: Release
        uses: goreleaser/goreleaser-action@v2
        with:
          version: v0.183.0
          args: release -f=goreleaser.yml --snapshot --skip-publish --rm-dist

      # Upload
      - name: Upload artifacts (FreeBSD-32bit.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_FreeBSD-32bit.tar.gz
          path: ./dist/trivy_*FreeBSD-32bit.tar.gz
          if-no-files-found: error

      - name: Upload artifacts (FreeBSD-64bit.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_FreeBSD-64bit.tar.gz
          path: ./dist/trivy_*FreeBSD-64bit.tar.gz
          if-no-files-found: error

      - name: Upload artifacts (FreeBSD-ARM.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_FreeBSD-ARM.tar.gz
          path: ./dist/trivy_*FreeBSD-ARM.tar.gz
          if-no-files-found: error

      - name: Upload artifacts (FreeBSD-ARM64.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_FreeBSD-ARM64.tar.gz
          path: ./dist/trivy_*FreeBSD-ARM64.tar.gz
          if-no-files-found: error

      - name: Upload artifacts (Linux-32bit.deb)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-32bit.deb
          path: ./dist/trivy_*Linux-32bit.deb
          if-no-files-found: error

      - name: Upload artifacts (Linux-32bit.rpm)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-32bit.rpm
          path: ./dist/trivy_*Linux-32bit.rpm
          if-no-files-found: error

      - name: Upload artifacts (Linux-32bit.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-32bit.tar.gz
          path: ./dist/trivy_*Linux-32bit.tar.gz
          if-no-files-found: error

      - name: Upload artifacts (Linux-64bit.deb)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-64bit.deb
          path: ./dist/trivy_*Linux-64bit.deb
          if-no-files-found: error

      - name: Upload artifacts (Linux-64bit.rpm)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-64bit.rpm
          path: ./dist/trivy_*Linux-64bit.rpm
          if-no-files-found: error

      - name: Upload artifacts (Linux-64bit.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-64bit.tar.gz
          path: ./dist/trivy_*Linux-64bit.tar.gz
          if-no-files-found: error

      - name: Upload artifacts (Linux-ARM.deb)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-ARM.deb
          path: ./dist/trivy_*Linux-ARM.deb
          if-no-files-found: error

      - name: Upload artifacts (Linux-ARM.rpm)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-ARM.rpm
          path: ./dist/trivy_*Linux-ARM.rpm
          if-no-files-found: error

      - name: Upload artifacts (Linux-ARM.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-ARM.tar.gz
          path: ./dist/trivy_*Linux-ARM.tar.gz
          if-no-files-found: error

      - name: Upload artifacts (Linux-ARM64.deb)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-ARM64.deb
          path: ./dist/trivy_*Linux-ARM64.deb
          if-no-files-found: error

      - name: Upload artifacts (Linux-ARM64.rpm)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-ARM64.rpm
          path: ./dist/trivy_*Linux-ARM64.rpm
          if-no-files-found: error

      - name: Upload artifacts (Linux-ARM64.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-ARM64.tar.gz
          path: ./dist/trivy_*Linux-ARM64.tar.gz   
          if-no-files-found: error    

      - name: Upload artifacts (Linux-PPC64LE.deb)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-PPC64LE.deb
          path: ./dist/trivy_*Linux-PPC64LE.deb
          if-no-files-found: error

      - name: Upload artifacts (Linux-PPC64LE.rpm)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-PPC64LE.rpm
          path: ./dist/trivy_*Linux-PPC64LE.rpm
          if-no-files-found: error

      - name: Upload artifacts (Linux-PPC64LE.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-PPC64LE.tar.gz
          path: ./dist/trivy_*Linux-PPC64LE.tar.gz    
          if-no-files-found: error 

      - name: Upload artifacts (Linux-s390x.deb)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-s390x.deb
          path: ./dist/trivy_*Linux-s390x.deb
          if-no-files-found: error

      - name: Upload artifacts (Linux-s390x.rpm)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-s390x.rpm
          path: ./dist/trivy_*Linux-s390x.rpm
          if-no-files-found: error

      - name: Upload artifacts (Linux-s390x.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_Linux-s390x.tar.gz
          path: ./dist/trivy_*Linux-s390x.tar.gz     
          if-no-files-found: error       

      - name: Upload artifacts (macOS-64bit.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_macOS-64bit.tar.gz
          path: ./dist/trivy_*macOS-64bit.tar.gz  
          if-no-files-found: error

      - name: Upload artifacts (macOS-ARM64.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_macOS-ARM64.tar.gz
          path: ./dist/trivy_*macOS-ARM64.tar.gz   
          if-no-files-found: error   

      - name: Upload artifacts (OpenBSD-32bit.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_OpenBSD-32bit.tar.gz
          path: ./dist/trivy_*OpenBSD-32bit.tar.gz 
          if-no-files-found: error 

      - name: Upload artifacts (OpenBSD-64bit.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_OpenBSD-64bit.tar.gz
          path: ./dist/trivy_*OpenBSD-64bit.tar.gz  
          if-no-files-found: error   

      - name: Upload artifacts (OpenBSD-ARM.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_OpenBSD-ARM.tar.gz
          path: ./dist/trivy_*OpenBSD-ARM.tar.gz 
          if-no-files-found: error

      - name: Upload artifacts (OpenBSD-ARM64.tar.gz)
        uses: actions/upload-artifact@v2
        with:
          name: trivy_OpenBSD-ARM64.tar.gz
          path: ./dist/trivy_*OpenBSD-ARM64.tar.gz
          if-no-files-found: error